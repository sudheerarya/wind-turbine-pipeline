{
  "name": "Wind Turbine Pipeline (Serverless)",
  "job_clusters": [
    {
      "job_cluster_key": "serverless_small",
      "new_cluster": {
        "spark_version": "13.3.x-scala2.12",
        "num_workers": 2,
        "data_security_mode": "SINGLE_USER",
        "runtime_engine": "STANDARD",
        "serverless": true
      }
    }
  ],
  "parameters": [
    {
      "name": "catalog",
      "default": "main"
    },
    {
      "name": "schema",
      "default": "turbine"
    },
    {
      "name": "raw_data_path",
      "default": "data/sample"
    },
    {
      "name": "bronze_table",
      "default": "bronze_readings"
    },
    {
      "name": "silver_table",
      "default": "silver_readings"
    },
    {
      "name": "gold_stats_table",
      "default": "gold_turbine_stats"
    },
    {
      "name": "gold_anomalies_table",
      "default": "gold_turbine_anomalies"
    },
    {
      "name": "anomaly_z_threshold",
      "default": "2.0"
    }
  ],
  "tasks": [
    {
      "task_key": "bronze_ingest",
      "job_cluster_key": "serverless_small",
      "notebook_task": {
        "notebook_path": "notebooks/01_bronze_ingestion.py",
        "base_parameters": {
          "catalog": "{{catalog}}",
          "schema": "{{schema}}",
          "raw_data_path": "{{raw_data_path}}",
          "bronze_table": "{{bronze_table}}"
        }
      }
    },
    {
      "task_key": "silver_transform",
      "depends_on": [
        {
          "task_key": "bronze_ingest"
        }
      ],
      "job_cluster_key": "serverless_small",
      "notebook_task": {
        "notebook_path": "notebooks/02_silver_transformation.py",
        "base_parameters": {
          "catalog": "{{catalog}}",
          "schema": "{{schema}}",
          "bronze_table": "{{bronze_table}}",
          "silver_table": "{{silver_table}}"
        }
      }
    },
    {
      "task_key": "gold_aggregate",
      "depends_on": [
        {
          "task_key": "silver_transform"
        }
      ],
      "job_cluster_key": "serverless_small",
      "notebook_task": {
        "notebook_path": "notebooks/03_gold_aggregation.py",
        "base_parameters": {
          "catalog": "{{catalog}}",
          "schema": "{{schema}}",
          "silver_table": "{{silver_table}}",
          "gold_stats_table": "{{gold_stats_table}}",
          "gold_anomalies_table": "{{gold_anomalies_table}}",
          "anomaly_z_threshold": "{{anomaly_z_threshold}}"
        }
      }
    }
  ]
}